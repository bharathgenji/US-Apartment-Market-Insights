<!--- Rmarkdown for the paper. --->
<!--- Zachary Perry group 5 I think --->

---
title: "Summary of Research and EDA Process on the Apartment Rental Dataset"
author: "Zachary Perry"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Introduction

The U.S. rental market plays a crucial role in the economy, being influenced by a range of socio-economic factors. With more data now available, we have a chance to gain deeper insights into this market.

In this report, we examine a dataset of 10,000 U.S. apartment rentals from the UCI database, enhanced with "RentLingo" listings. We focus on key attributes like location, square footage, and amenities, giving us a broad view of the rental scene.

## 1. What do we know about this dataset?

The dataset provides a comprehensive view of the U.S. apartment rental landscape, capturing key attributes of rental listings. Among the most informative variables, we have location data, which includes attributes like state and city, pinpointing the geographical context of each listing. Additionally, there are physical characteristics that reveal details such as square footage, indicating the size and layout of the apartment. We also have amenities, a qualitative descriptor that highlights the additional features or services that come with each rental.

### 1.1 Data Source and Observations

The dataset, sourced from the UCI database, consists of 10,000 observations. Each entry represents a unique rental listing, forming a solid foundation for our analysis. As with many externally acquired datasets, cleaning the data was an essential step to ensure its quality and reliability. What follows is an overview of the dataset, showcasing variable definitions and pinpointing any missing values, which offers clarity regarding our analytical scope.

<!-- % The code to generate this needs to be inset -->
![Summary Statistics of Dataset](./Summary stats of dataset.png)

### 1.2 Attributes and Data Dimensions

The dataset captures several key attributes of rental listings. The state indicates the geographical location of the listing, which aids in regional trend analysis. The size of the property is denoted by square_feet, a primary influencer of the rental price. Rental prices are reflected in the price_display. Information about the apartment's structure is provided through bedrooms and bathrooms. Additionally, the amenities column lists the extra features or facilities associated with the property. These variables, among others, allow for a thorough exploration of the US rental market landscape.

To understand the relationships between these attributes, especially the numerical ones, a correlation matrix can be invaluable:

<!-- % Need the inset code to create the correllation matrix -->
![Correlation Matrix](./Correllation Matrix.png)

This matrix provides a visual representation of how different variables in the dataset relate to each other. Strong correlations, whether positive or negative, can hint at underlying patterns and relationships that might be pivotal in subsequent analyses.

## 3. How was the information gathered?

The origin of this dataset is the UCI database, but the original data compilation was executed by "RentLingo", an online platform. This suggests a digital scraping or aggregation method, wherein listings from various sources might have been collated. It's essential to recognize the potential biases that might arise from such collection methods, such as over-representation of certain types of listings or geographies.

## 4. Inital Analyses and Findings

Diving into the dataset, we first focused on data refinement, ensuring its clarity and usability. This step was crucial in setting up a comprehensive Exploratory Data Analysis (EDA). During EDA, we identified key patterns and relationships between various attributes. Our main objective was to grasp the dataset's depth and its potential for predictive modeling.

An important aspect of our analysis was to assess the significance of using the states column to group listings, as the real estate market is extremely localized. To validate this approach, we used an ANOVA test, the results of which are shared in the subsequent section.

<!-- % Need the inset code for this section -->
![ANOVA Results](./ANOVA.png)

A strikingly low p-value of \(2 \times 10^{-16}\)  robustly attests to the significance of grouping listings by state. This result indicates that not only is state-based categorization valid, but it's also a potent tool for drawing accurate conclusions and shaping predictive models. This insight reinforces the value of considering regional variations within the dataset.

## 5. Research Contribution to Question Development

In our initial analysis phase, we identified two distinct categories within the data: invariant and variant factors. We first turned our attention to the invariant factors, such as the impact of photo availability on rental prices. These factors provided insights that were consistent regardless of location.

As our analysis progressed, the variant factors, particularly those related to geographic location, came into sharper focus. We observed noticeable differences in rental prices across states, leading us to craft state-specific questions. For example, we explored whether an apartment's proximity to city centers or its size influenced its rental price differently in various states.

This structured approach allowed us to dissect the data methodically, beginning with universal trends and then zooming in on location-based nuances.
## Chi-Squared Results

Question 1: Relationship between Photo Availability and Price Type

We examine how the availability of photos in a listing correlates with the way rental prices are presented. 
In this stacked bar chart, we can see that there are noticeable differences in photo availability across various price types.

![Chi-Squared Results 1](Chi-Squared Results 1_Relationship between Photo Availability and Price Type.jpeg)

Question 2: Distribution of Listings Across States

We also take a look at the geographical distribution of apartment listings across the United States. 
In this visualization, each bar represents a state, and the height of the bar correlates with the number of listings in that state.
There are clear trends visible, with certain states showing a much higher number of listings, such as California and Texas.This uneven distribution indicates potential market hotspots and areas that may require more attention or resources to boost listing numbers.

![Chi-Squared Results 2](Chi-Squared Results 2_Distribution of Listings Across States.jpeg)

Question 3: Association Between Pets Allowed Status and Rent Prices

We also Investigate the association between "pets allowed" status and different rent price ranges, by using Chi-square test on the contingency table of "pets allowed" status and rent price categories.
We categorized the rental prices into three ranges: Low, Medium, and High.
A Chi-square test was conducted on a contingency table, comprising these price ranges and the pets allowed status. 
The results were quite telling, with a Chi-square value of 292.76, and an extremely low p-value, practically zero. 
This leads us to reject the null hypothesis, concluding a significant association between the pets allowed status and the rental price ranges. 

![Chi-Squared Results 3](Chi-Squared Results 3_Pets Allowed vs. Price Range.jpeg)

SMART Question 9: What is the average rental price per square foot for apartments in different states within the dataset, and how do these prices compare to the overall dataset average?

In addressing Question 9, we determined the average rental price per square foot for apartments in various states. This measure offers insights into the typical costs renters might face based on apartment size across different regions. When juxtaposing these state-specific averages against the overall dataset average, we observed distinctive regional pricing trends. The ensuing chart details these discrepancies, displaying how each state's average price per square foot relates to the national average:

<!-- Zac needs to inset the code here. -->
<!-- ![Average Square Footage by State](./Avg_price_sqft_state.jpeg) -->

``` {r , echo = FALSE}

# here we have two checks to make sure that the packages are loaded and installed
#if (!require(readxl)) {
#  install.packages("readxl")
#}
library(readxl)

#if (!require(knitr)) {
#  install.packages("knitr")
#}
library(knitr)

#if (!require(dplyr)) {
#  install.packages("dplyr")
#}
library(dplyr)

# Read the Excel file
df <- read_excel("cleaned_data.xlsx")

# List of valid US state abbreviations
valid_states <- c(
    "AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL", "GA",
    "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD",
    "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ",
    "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC",
    "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"
)

# Update the list of valid US state abbreviations to include DC
valid_states <- c(valid_states, "DC")

# Filter out rows where the state is not in the list of valid states
filtered_df_with_dc <- df[df$state %in% valid_states, ]

# Convert square_feet to numeric, setting any non-numeric values to NA
filtered_df_with_dc$square_feet <- as.numeric(as.character(filtered_df_with_dc$square_feet))

# Check for any non-numeric values that might have been converted to NAs
na_square_feet_count <- sum(is.na(filtered_df_with_dc$square_feet))
cat("Number of NA values in square_feet:", na_square_feet_count, "\n")

# Compute the average rental price per square foot and the count of observations for each state
statewise_stats <- filtered_df_with_dc %>%
  filter(!is.na(square_feet) & square_feet > 0) %>%
  group_by(state) %>%
  summarize(
    avg_price_per_sqft = round(mean(price / square_feet, na.rm = TRUE), 2),
    count = n()
  )

# Compute the weighted average rental price per square foot for each state
statewise_stats$weighted_avg_price_per_sqft <- statewise_stats$avg_price_per_sqft * statewise_stats$count

# Compute the overall weighted average rental price per square foot for the entire dataset
overall_weighted_avg_price_per_sqft <- sum(statewise_stats$weighted_avg_price_per_sqft) / sum(statewise_stats$count)

#if (!require(ggplot2)) {
#  install.packages("ggplot2")
#}
library(ggplot2)

# Create a bubble plot with adjusted red line label and legend position
bubble_plot <- ggplot(statewise_stats, aes(x = state, y = avg_price_per_sqft, size = count)) +
  geom_point(alpha = 0.7, color = "dodgerblue") +
  geom_hline(yintercept = overall_weighted_avg_price_per_sqft, color = "red", linetype="dashed", size=0.7) +
  annotate("text", x = max(statewise_stats$state), y = overall_weighted_avg_price_per_sqft + 0.1, 
           label = paste0("$", round(overall_weighted_avg_price_per_sqft, 2)), color = "red", hjust = "right") +
  labs(
    title = "Weighted Average Rental Price Per Square Foot by State",
    subtitle = paste0("Overall avg. price/sqft: $", round(overall_weighted_avg_price_per_sqft, 2)),
    x = "State",
    y = "Price ($/sqft)",
    size = "Number of Listings"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels by 45 degrees
    legend.position = "top"  # Move the legend to the top
  )

# Display the plot
bubble_plot

```

Interestingly the vast majority of states are below this average, and this is because of the massive skew caused by the California housing market. It is simply egregious and this skew can be visually shown in a graph. Other markets such as MA and HI have similarly priced markets but the size itself is the concern here, as it is the third highest quantity of all 50 states.

![Average Price by State](./Plot of average.png)

Deeper into this a regression of sq_ft ~ price for TX, CA, and NY can be taken to show the `Locational Premium` or the amount of price determined by the location as opposed to the square footage. 

<div style="display: flex; justify-content: space-between;">
  <img src="sqft ~ price CA.jpeg" width="45%" />
  <img src="sqft ~ price TX.jpeg" width="45%" />
</div>

Comparing the slopes of CA and TX their slopes are somewhat similar, but the skew of the data itself is immensely different.It is clearly shows the skew of the CA market contrasted against a more affordable market such as with Texas every value has been thrown to the right of the graph. The clustering in Texas much more closely follows the weighted square average calculated earlier.

Finally, we have New York, which seems to have the locational premium makeup the majority of the price of listings. It possesses a negative slope, with ordered pairs of square_foot and price being distributed over the entirety of the graph. This suggests that the housing market of New York is not overly reliant on square footage to determine price but instead on the location of the dwelling itself.

![New York Locational Premium](./sqft~ price NY.jpeg)

To further substantiate our findings, we referred to the graph depicting the average square footage by state (see attached JPEG). The visual representation corroborates our analysis, showing New York leading the pack with the highest average square footage, followed closely by California and then Texas. This pattern aligns with our earlier observation that in areas where rent is less influenced by square footage, the average square footage tends to be higher. Specifically, in New York, where the locational premium seems to dominate rental pricing, dwellings offer more spacious interiors on average compared to other states.

![Average Square Foor by State Descending](./Average sqft by state.jpeg)

## 6. Beneficial Augmentations to the Dataset

While the current dataset provides a valuable snapshot of the US apartment rental market, several enhancements can bolster its analytical and predictive capabilities. Incorporating these additions would enable a more robust and nuanced understanding of rental dynamics, catering to various stakeholders in the rental ecosystem.

### 6.1 Year-Round Data

The present dataset captures listings from September to December, offering a limited temporal perspective. A comprehensive year-round dataset would provide insights into how rental trends fluctuate across different seasons. Such information is invaluable for understanding seasonal demand patterns, rental pricing variations, and tenant mobility trends. For example, are there specific months where rentals spike due to student movements or major cultural events? Do certain seasons see a dip in rentals due to climatic challenges? Addressing these questions requires a dataset that spans the entire calendar year.

### 6.2 Enhanced State-Level Observations

One of the challenges faced in our analysis was the limited number of observations for several states, which hindered robust state-level analyses. Ensuring that each state has a statistically significant number of observations would provide a more balanced and accurate representation of regional rental trends. This would enable state-specific insights, allowing for tailored strategies and interventions for different regions.

### 6.3 Non-Bundled Amenities Data

The current dataset provides information on amenities, but there's an opportunity to delve deeper. Listings often bundle multiple amenities together, making it challenging to discern the individual value and appeal of each amenity. A dataset that itemizes non-bundled amenities—listing them separately for each property—would allow for a more granular analysis. For instance, how much value does a gym add compared to a swimming pool? Is a pet-friendly policy more attractive in urban settings compared to suburban ones? By isolating amenities, we can derive more precise insights into their individual impact on rental prices and tenant preferences.

In essence, while the existing dataset serves as a solid foundation for understanding the rental market, these proposed augmentations would significantly enhance its depth and breadth. Such enhancements would ensure that the dataset not only reflects the current rental landscape but also anticipates future trends and challenges.


## 7. Evolution of the Research Question Post-EDA

Exploratory Data Analysis (EDA) is a dynamic process that allows researchers to dive deep into datasets, uncovering patterns, relationships, and insights that might not be immediately evident. This iterative exploration often results in the evolution and refinement of the research questions. Here's how our research questions evolved post-EDA:

### 7.1 Deepened Understanding of Variable Interactions

Our initial questions were primarily centered around the direct relationships between individual variables. However, post-EDA, it became evident that many of these variables interact in complex ways. For instance, the relationship between rental price and amenities isn't linear but may vary based on location, apartment size, or even the season. This nuanced understanding prompted us to reframe our questions to account for these multifaceted interactions.

### 7.2 Emphasis on Geographic Trends

The EDA revealed significant geographic disparities in the dataset, especially concerning rental prices and apartment sizes across different states. This led to a heightened focus on state-specific analyses, with questions tailored to understand the unique rental landscapes of individual states. Queries that initially looked at the US rental market holistically were now complemented by state-centric questions to capture regional nuances.

### 7.3 Incorporation of Qualitative Insights

While our initial questions were predominantly quantitative, the EDA emphasized the importance of qualitative descriptors in the dataset, such as the body and amenities columns. This led to the formulation of questions that sought to understand the perceived value of listings, the narrative appeal, and how qualitative factors influence rental decisions.

### 7.4 Broader Temporal Perspective

The dataset's limitation to the months of September to December initially restricted our temporal analyses. However, post-EDA, we recognized the potential insights that could be gleaned from a year-round perspective, leading to questions about seasonal trends, monthly fluctuations, and the potential impact of major events on rental patterns.

### 7.5 Focus on Potential Biases and Data Limitations

The EDA process highlighted potential biases in the dataset, especially concerning the collection method and the over-representation or under-representation of certain types of listings. This prompted questions about the validity of certain insights, the potential for skewed results, and the need for data augmentation to address these biases.

In conclusion, the EDA process was instrumental in refining our research direction. It allowed us to pivot from broader, more general questions to specific, nuanced queries that truly capture the complexities of the US apartment rental market. As we move forward, these refined questions will guide our analyses, ensuring that our conclusions are both robust and relevant.
